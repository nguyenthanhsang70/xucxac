<!DOCTYPE html>

<html lang="vi">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Stopwatch Challenge</title>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

        body {

            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);

            min-height: 100vh;

            display: flex;

            justify-content: center;

            align-items: center;

            color: white;

            overflow: hidden;

        }

        .game-container {

            background: rgba(255, 255, 255, 0.15);

            backdrop-filter: blur(12px);

            border-radius: 24px;

            padding: 32px;

            text-align: center;

            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);

            border: 1px solid rgba(255, 255, 255, 0.2);

            width: 100%;

            max-width: 480px;

            position: relative;

            transition: transform 0.3s ease;

        }

        .game-container:hover {

            transform: translateY(-5px);

        }

        .top-icons {

            position: absolute;

            top: 16px;

            left: 16px;

            right: 16px;

            display: flex;

            justify-content: space-between;

            align-items: center;

        }

        .back-icon, .info-icon {

            width: 40px;

            height: 40px;

            border-radius: 12px;

            background: rgba(255, 255, 255, 0.15);

            border: 1px solid rgba(255, 255, 255, 0.2);

            display: flex;

            align-items: center;

            justify-content: center;

            cursor: pointer;

            font-size: 20px;

            font-weight: 600;

            transition: all 0.3s ease;

            text-decoration: none;

            color: white;

        }

        .back-icon:hover {

            background: #ff4757;

            transform: rotate(-10deg);

        }

        .info-icon:hover {

            background: #ffa502;

            transform: rotate(10deg);

        }

        .modal-overlay {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0, 0, 0, 0.75);

            display: none;

            justify-content: center;

            align-items: center;

            z-index: 1000;

        }

        .modal-content {

            background: white;

            color: #1a1a1a;

            padding: 20px;

            border-radius: 16px;

            max-width: 400px;

            width: 90%;

            max-height: 70vh;

            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);

            animation: modalPop 0.4s ease-out;

            display: flex;

            flex-direction: column;

        }

        @keyframes modalPop {

            from {

                opacity: 0;

                transform: scale(0.85) translateY(-20px);

            }

            to {

                opacity: 1;

                transform: scale(1) translateY(0);

            }

        }

        .modal-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 16px;

        }

        .modal-title {

            font-size: 1.5rem;

            font-weight: 700;

            color: #1e3c72;

        }

        .close-btn {

            background: rgba(0, 0, 0, 0.05);

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: #666;

            padding: 6px;

            border-radius: 50%;

            transition: all 0.3s ease;

        }

        .close-btn:hover {

            background: #ff4757;

            color: white;

        }

        .instructions {

            text-align: left;

            line-height: 1.6;

            font-size: 0.95rem;

            overflow-y: auto;

            max-height: 50vh;

            padding-right: 8px;

            scrollbar-width: thin;

            scrollbar-color: #1e3c72 rgba(0, 0, 0, 0.1);

        }

        .instructions::-webkit-scrollbar {

            width: 6px;

        }

        .instructions::-webkit-scrollbar-track {

            background: rgba(0, 0, 0, 0.1);

            border-radius: 8px;

        }

        .instructions::-webkit-scrollbar-thumb {

            background: #1e3c72;

            border-radius: 8px;

        }

        .instruction-item {

            margin-bottom: 12px;

            padding: 10px;

            background: rgba(30, 60, 114, 0.05);

            border-radius: 8px;

            border-left: 3px solid #1e3c72;

        }

        .instruction-title {

            font-weight: 600;

            color: #1e3c72;

            margin-bottom: 6px;

            font-size: 1rem;

        }

        .keyboard-shortcuts {

            background: rgba(255, 165, 2, 0.1);

            border-left-color: #ffa502;

        }

        .title {

            font-size: 2.5rem;

            font-weight: 800;

            margin-bottom: 24px;

            background: linear-gradient(45deg, #ffd32a, #ff7f50);

            -webkit-background-clip: text;

            background-clip: text;

            -webkit-text-fill-color: transparent;

            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);

        }

        .level-info {

            display: flex;

            justify-content: space-between;

            font-size: 1.1rem;

            margin-bottom: 24px;

            padding: 12px;

            background: rgba(255, 255, 255, 0.1);

            border-radius: 12px;

            font-weight: 500;

        }

        .timer-display {

            font-size: 3.5rem;

            font-weight: 700;

            margin: 24px 0;

            min-height: 80px;

            display: flex;

            align-items: center;

            justify-content: center;

            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);

            transition: all 0.3s ease;

        }

        .countdown {

            color: #ff4757;

            animation: pulse 0.8s infinite;

        }

        .running {

            color: #2ed573;

        }

        .stopped {

            color: #ffa502;

        }

        @keyframes pulse {

            0% { transform: scale(1); }

            50% { transform: scale(1.08); }

            100% { transform: scale(1); }

        }

        .control-btn {

            border: none;

            color: white;

            padding: 12px 24px;

            font-size: 1.1rem;

            font-weight: 600;

            border-radius: 12px;

            cursor: pointer;

            margin: 8px;

            transition: all 0.3s ease;

            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);

        }

        .control-btn:hover {

            transform: translateY(-3px);

            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);

        }

        .control-btn:disabled {

            background: #4b6584;

            cursor: not-allowed;

            transform: none;

        }

        .start-btn {

            background: linear-gradient(45deg, #2ed573, #1e90ff);

        }

        .stop-btn {

            background: linear-gradient(45deg, #ff7f50, #ff4757);

        }

        .reset-btn {

            background: linear-gradient(45deg, #a4b0be, #747d8c);

        }

        .result {

            margin: 24px 0;

            padding: 12px;

            border-radius: 12px;

            font-size: 1.1rem;

            min-height: 60px;

            display: flex;

            align-items: center;

            justify-content: center;

            font-weight: 500;

        }

        .result.perfect {

            background: linear-gradient(45deg, #2ed573, #1e90ff);

            color: white;

            animation: celebration 0.6s ease-in-out;

        }

        .result.miss {

            background: linear-gradient(45deg, #ff4757, #c23616);

            color: white;

        }

        @keyframes celebration {

            0% { transform: scale(1); }

            50% { transform: scale(1.06); }

            100% { transform: scale(1); }

        }

        .progress {

            margin: 24px 0;

        }

        .progress-bar {

            background: rgba(255, 255, 255, 0.15);

            height: 12px;

            border-radius: 6px;

            overflow: hidden;

        }

        .progress-fill {

            height: 100%;

            background: linear-gradient(45deg, #2ed573, #1e90ff);

            transition: width 0.4s ease;

        }

        .confetti {

            position: fixed;

            top: -10px;

            width: 12px;

            height: 12px;

            background: #ffd32a;

            animation: confetti-fall 2.5s linear infinite;

        }

        @keyframes confetti-fall {

            to {

                transform: translateY(100vh) rotate(720deg);

            }

        }

    </style>

</head>

<body>

    <div class="game-container">

        <div class="top-icons">

            <a class="back-icon" href="game.html" title="Quay lại trang chính">←</a>

            <div class="info-icon" onclick="showInstructions()" title="Hướng dẫn chơi">i</div>

        </div>

        <h1 class="title">Stopwatch Challenge</h1>

        <div class="level-info">

            <div>Level: <span id="level">1</span>/20</div>

            <div>Mục tiêu: <span id="target">10.00</span>s</div>

        </div>

        <div class="progress">

            <div class="progress-bar">

                <div class="progress-fill" id="progress" style="width: 5%"></div>

            </div>

        </div>

        <div class="timer-display" id="timer">Sẵn sàng?</div>

        <div class="result" id="result"></div>

        <div class="controls">

            <button class="control-btn start-btn" id="startBtn" onclick="startGame()">Bắt đầu</button>

            <button class="control-btn stop-btn" id="stopBtn" onclick="stopTimer()" disabled>Dừng!</button>

            <button class="control-btn reset-btn" id="resetBtn" onclick="resetGame()">Chơi lại</button>

        </div>

    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="hideInstructions()">

        <div class="modal-content" onclick="event.stopPropagation()">

            <div class="modal-header">

                <div class="modal-title">📖 Hướng dẫn chơi</div>

                <button class="close-btn" onclick="hideInstructions()">×</button>

            </div>

            <div class="instructions">

                <div class="instruction-item">

                    <div class="instruction-title">🎯 Mục tiêu</div>

                    <div>Hoàn thành 20 level bằng cách đoán chính xác thời gian mục tiêu (sai số ≤ 0.3 giây)</div>

                </div>

                <div class="instruction-item">

                    <div class="instruction-title">🎮 Cách chơi</div>

                    <div>

                        1. Nhấn "Bắt đầu" để bắt đầu đếm ngược 3-2-1<br>

                        2. Sau khi đếm ngược, màn hình sẽ hiển thị "❓" - lúc này hãy đếm thời gian trong đầu<br>

                        3. Khi bạn nghĩ đã đủ thời gian mục tiêu, nhấn "Dừng!"<br>

                        4. Nếu sai số ≤ 0.3s → THẮNG và chuyển level tiếp theo<br>

                        5. Nếu sai số > 0.3s → THUA và phải chơi lại level hiện tại

                    </div>

                </div>

                <div class="instruction-item">

                    <div class="instruction-title">📈 Level & Thời gian</div>

                    <div>

                        • Level 1: 10.00s<br>

                        • Level 2: 20.00s<br>

                        • Level 3: 30.00s<br>

                        • ... (tăng 10s mỗi level)<br>

                        • Level 20: 200.00s

                    </div>

                </div>

                <div class="instruction-item keyboard-shortcuts">

                    <div class="instruction-title">⌨️ Phím tắt</div>

                    <div>

                        • <strong>Space</strong>: Bắt đầu game hoặc Dừng timer<br>

                        • <strong>R</strong>: Reset game về level 1

                    </div>

                </div>

                <div class="instruction-item">

                    <div class="instruction-title">💡 Mẹo chơi</div>

                    <div>

                        • Tập trung và đếm đều đặn trong đầu<br>

                        • Có thể đếm "1-một-nghìn, 2-một-nghìn..." để chính xác hơn<br>

                        • Luyện tập với những level dễ trước khi thử thách bản thân

                    </div>

                </div>

            </div>

        </div>

    </div>

    <script>

        let currentLevel = 1;

        let targetTime = 10.0;

        let gameTimer = null;

        let countdownTimer = null;

        let startTime = 0;

        let isCountingDown = false;

        let isRunning = false;

        let gameState = 'ready';

        const timerDisplay = document.getElementById('timer');

        const startBtn = document.getElementById('startBtn');

        const stopBtn = document.getElementById('stopBtn');

        const resetBtn = document.getElementById('resetBtn');

        const resultDiv = document.getElementById('result');

        const levelSpan = document.getElementById('level');

        const targetSpan = document.getElementById('target');

        const progressBar = document.getElementById('progress');

        const modalOverlay = document.getElementById('modalOverlay');

        function showInstructions() {

            modalOverlay.style.display = 'flex';

        }

        function hideInstructions() {

            modalOverlay.style.display = 'none';

        }

        function updateDisplay() {

            levelSpan.textContent = currentLevel;

            targetSpan.textContent = targetTime.toFixed(2);

            progressBar.style.width = (currentLevel / 20 * 100) + '%';

        }

        function startGame() {

            if (gameState !== 'ready') return;

            gameState = 'countdown';

            startBtn.disabled = true;

            stopBtn.disabled = true;

            resultDiv.textContent = '';

            resultDiv.className = 'result';

            let countdown = 3;

            timerDisplay.textContent = countdown;

            timerDisplay.className = 'timer-display countdown';

            countdownTimer = setInterval(() => {

                countdown--;

                if (countdown > 0) {

                    timerDisplay.textContent = countdown;

                } else {

                    clearInterval(countdownTimer);

                    startTimer();

                }

            }, 1000);

        }

        function startTimer() {

            gameState = 'running';

            startTime = Date.now();

            stopBtn.disabled = false;

            timerDisplay.className = 'timer-display running';

            timerDisplay.textContent = '❓';

            timerDisplay.style.fontSize = '6rem';

            gameTimer = setInterval(() => {

                const elapsed = (Date.now() - startTime) / 1000;

            }, 10);

        }

        function stopTimer() {

            if (gameState !== 'running') return;

            gameState = 'stopped';

            clearInterval(gameTimer);

            const finalTime = (Date.now() - startTime) / 1000;

            const difference = Math.abs(finalTime - targetTime);

            timerDisplay.className = 'timer-display stopped';

            stopBtn.disabled = true;

            showResult(finalTime, difference);

        }

        function showResult(finalTime, difference) {

            let message = '';

            let className = 'result';

            timerDisplay.textContent = finalTime.toFixed(2) + 's';

            timerDisplay.style.fontSize = '3.5rem';

            if (difference <= 0.3) {

                message = `🎉 THẮNG! Thời gian: ${finalTime.toFixed(2)}s - Chênh lệch: ${difference.toFixed(3)}s`;

                className += ' perfect';

                nextLevel();

                createConfetti();

            } else {

                message = `😅 THUA! Thời gian: ${finalTime.toFixed(2)}s - Chênh lệch: ${difference.toFixed(3)}s`;

                className += ' miss';

            }

            resultDiv.textContent = message;

            resultDiv.className = className;

            setTimeout(() => {

                if (currentLevel <= 20) {

                    resetForNextRound();

                }

            }, 3000);

        }

        function nextLevel() {

            if (currentLevel < 20) {

                currentLevel++;

                targetTime += 10;

                updateDisplay();

            } else {

                showGameComplete();

            }

        }

        function showGameComplete() {

            timerDisplay.textContent = '🏆 HOÀN THÀNH!';

            resultDiv.textContent = 'Chúc mừng! Bạn đã hoàn thành tất cả 20 level!';

            resultDiv.className = 'result perfect';

            createConfetti();

            setTimeout(() => {

                if (confirm('Chơi lại từ đầu?')) {

                    resetGame();

                }

            }, 3000);

        }

        function resetForNextRound() {

            gameState = 'ready';

            startBtn.disabled = false;

            stopBtn.disabled = true;

            timerDisplay.textContent = 'Level ' + currentLevel + ' - Sẵn sàng?';

            timerDisplay.className = 'timer-display';

            timerDisplay.style.fontSize = '3.5rem';

        }

        function resetGame() {

            clearInterval(gameTimer);

            clearInterval(countdownTimer);

            currentLevel = 1;

            targetTime = 10.0;

            gameState = 'ready';

            startBtn.disabled = false;

            stopBtn.disabled = true;

            timerDisplay.textContent = 'Sẵn sàng?';

            timerDisplay.className = 'timer-display';

            timerDisplay.style.fontSize = '3.5rem';

            resultDiv.textContent = '';

            resultDiv.className = 'result';

            updateDisplay();

        }

        function createConfetti() {

            const colors = ['#ffd32a', '#ff4757', '#2ed573', '#1e90ff', '#ff7f50', '#70a1ff'];

            for (let i = 0; i < 50; i++) {

                setTimeout(() => {

                    const confetti = document.createElement('div');

                    confetti.className = 'confetti';

                    confetti.style.left = Math.random() * 100 + 'vw';

                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                    confetti.style.animationDelay = Math.random() * 2 + 's';

                    document.body.appendChild(confetti);

                    setTimeout(() => {

                        confetti.remove();

                    }, 3000);

                }, i * 80);

            }

        }

        updateDisplay();

        document.addEventListener('keydown', (e) => {

            if (e.code === 'Space') {

                e.preventDefault();

                if (gameState === 'ready') {

                    startGame();

                } else if (gameState === 'running') {

                    stopTimer();

                }

            } else if (e.code === 'KeyR') {

                resetGame();

            } else if (e.code === 'Escape') {

                hideInstructions();

            }

        });

    </script>

</body>

</html>
