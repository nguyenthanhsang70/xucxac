<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai là Thủ Phạm? - Trò Chơi Phá Án</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #A29BFE;
            --dark: #2D3436;
            --light: #F5F6FA;
            --success: #00B894;
            --danger: #D63031;
            --warning: #FDCB6E;
            --info: #0984E3;
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #2D3436 0%, #000000 100%);
            min-height: 100vh;
            color: var(--light);
            line-height: 1.6;
            padding: 15px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            padding: 15px 0;
        }
        
        .header::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: var(--primary);
            margin: 10px auto;
            border-radius: 2px;
        }
        
        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            margin-bottom: 8px;
            background: linear-gradient(to right, #A29BFE, #6C5CE7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }
        
        .header p {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            opacity: 0.9;
            padding: 0 10px;
        }
        
        .action-icons {
            position: absolute;
            top: 10px;
            right: 0;
            display: flex;
            gap: 8px;
        }
        
        .back-icon {
            position: absolute;
            top: 10px;
            left: 0;
        }
        
        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--card-bg);
            backdrop-filter: blur(5px);
            border: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 16px;
        }
        
        .icon-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.4rem, 3vw, 1.8rem);
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .suspects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        
        .suspect-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .suspect-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .suspect-card:hover {
            background: rgba(108, 92, 231, 0.2);
        }
        
        .suspect-card:hover::before {
            transform: scaleX(1);
        }
        
        .suspect-card.eliminated {
            background: rgba(214, 48, 49, 0.2);
            opacity: 0.7;
            border-color: var(--danger);
        }
        
        .suspect-card.selected {
            border-color: var(--success);
            background: rgba(0, 184, 148, 0.2);
        }
        
        .suspect-card.selected::before {
            background: var(--success);
            transform: scaleX(1);
        }
        
        .suspect-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            box-shadow: 0 3px 10px rgba(108, 92, 231, 0.4);
        }
        
        .suspect-card.eliminated .suspect-avatar {
            background: linear-gradient(45deg, #D63031, #FF7675);
        }
        
        .suspect-card.selected .suspect-avatar {
            background: linear-gradient(45deg, #00B894, #55EFC4);
        }
        
        .suspect-card h4 {
            font-size: 1rem;
            margin-bottom: 4px;
            color: var(--light);
        }
        
        .suspect-card p {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .clue-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .clue-item:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 3px 10px rgba(108, 92, 231, 0.4);
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn.success {
            background: linear-gradient(45deg, var(--success), #55EFC4);
            box-shadow: 0 3px 10px rgba(0, 184, 148, 0.4);
        }
        
        .btn.success:hover {
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.6);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, var(--warning), #FFEAA7);
            box-shadow: 0 3px 10px rgba(253, 203, 110, 0.4);
            color: var(--dark);
        }
        
        .btn.warning:hover {
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.6);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            padding: 15px;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2D3436 0%, #000000 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            animation: modalAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--danger);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            font-size: 14px;
        }
        
        .close-modal:hover {
            transform: rotate(90deg) scale(1.1);
        }
        
        .modal h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 15px;
            background: linear-gradient(to right, #A29BFE, #6C5CE7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .progress-info {
            font-size: 0.9rem;
            margin: 12px 0;
            padding: 8px;
            border-radius: 6px;
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid rgba(0, 184, 148, 0.3);
        }
        
        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons .btn {
            margin: 0;
            width: 100%;
        }
        
        /* Tablet and Desktop */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .header {
                margin-bottom: 30px;
                padding: 20px 0;
            }
            
            .header::after {
                width: 100px;
                height: 4px;
                margin: 15px auto;
            }
            
            .game-area {
                grid-template-columns: 1fr 1fr;
                gap: 25px;
                margin-bottom: 30px;
            }
            
            .card {
                padding: 25px;
                border-radius: 15px;
            }
            
            .suspects-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }
            
            .suspect-avatar {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }
            
            .suspect-card h4 {
                font-size: 1.1rem;
            }
            
            .suspect-card p {
                font-size: 0.9rem;
            }
            
            .clue-item {
                padding: 15px;
                font-size: 1rem;
            }
            
            .controls {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin: 25px 0;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .modal-buttons {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* Large Desktop */
        @media (min-width: 1200px) {
            .suspects-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
        
        /* Small Mobile */
        @media (max-width: 360px) {
            .suspects-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .suspect-avatar {
                width: 50px;
                height: 50px;
                font-size: 1.6rem;
            }
            
            .suspect-card h4 {
                font-size: 0.9rem;
            }
            
            .suspect-card p {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="icon-btn back-icon" onclick="goBack()">←</button>
            <h1>🔍 AI LÀ THỦ PHẠM?</h1>
            <p>Sử dụng các manh mối để tìm ra thủ phạm thực sự!</p>
            <div class="action-icons">
                <button class="icon-btn" onclick="showHelpModal()">i</button>
            </div>
        </div>
        
        <div class="game-area">
            <div class="card">
                <h2><span>📋</span> Thông Tin Vụ Án</h2>
                <div id="caseDetails">
                    <h3>🏠 Vụ Trộm Tại Biệt Thự Sang Trọng</h3>
                    <p><strong>Thời gian:</strong> Tối 15/8/2025, 20:00</p>
                    <p><strong>Địa điểm:</strong> Biệt thự của ông Minh, quận 1</p>
                    <p><strong>Vật bị mất:</strong> Chiếc nhẫn kim cương trị giá 2 tỷ đồng</p>
                    <p><strong>Tình huống:</strong> Ông Minh tổ chức tiệc sinh nhật, có 6 khách mời. Sau khi tiệc kết thúc, chiếc nhẫn kim cương trong két sắt biến mất!</p>
                </div>
                
                <h2><span>🎭</span> Nghi Phạm</h2>
                <div class="suspects-grid" id="suspectsGrid">
                    <!-- Suspects will be generated here -->
                </div>
                
                <div class="eliminated-list" id="eliminatedList" style="display: none;">
                    <h4>❌ Đã Loại Trừ:</h4>
                    <div id="eliminatedNames"></div>
                </div>
            </div>
            
            <div class="card">
                <h2><span>🔎</span> Manh Mối</h2>
                <div id="cluesList">
                    <!-- Clues will be generated here -->
                </div>
                
                <div class="controls">
                    <button class="btn" onclick="showNewClue()">
                        <span>🔍</span> Manh Mối Tiếp Theo
                    </button>
                    <button class="btn success" onclick="makeGuess()">
                        <span>🎯</span> Tôi Biết Thủ Phạm!
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Result Modal -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h2 id="resultTitle"></h2>
            <div id="resultContent"></div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeHelpModal()">&times;</button>
            <h2><span>📖</span> Hướng Dẫn Chơi</h2>
            <div style="text-align: left; margin-top: 15px;">
                <h3>🔍 Cách chơi:</h3>
                <p>1. Đọc kỹ thông tin vụ án và danh sách nghi phạm</p>
                <p>2. Nhấn nút "Manh Mối Tiếp Theo" để nhận manh mối mới</p>
                <p>3. Phân tích manh mối để loại trừ các nghi phạm vô tội</p>
                <p>4. Nhấn vào nghi phạm để loại trừ hoặc chọn lại</p>
                <p>5. Khi đã có đủ manh mối, nhấn "Tôi Biết Thủ Phạm!" để đưa ra kết luận</p>
                
                <h3 style="margin-top: 15px;">🎯 Mục tiêu:</h3>
                <p>- Tìm ra thủ phạm thực sự với ít manh mối nhất</p>
                <p>- Giải quyết tất cả các vụ án trong game</p>
                
                <h3 style="margin-top: 15px;">💡 Mẹo chơi:</h3>
                <p>- Kết hợp nhiều manh mối để có kết luận chính xác</p>
                <p>- Ghi chú lại các thông tin quan trọng</p>
                <p>- Đừng vội kết luận khi chưa có đủ bằng chứng</p>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeHelpModal()">Đã hiểu!</button>
            </div>
        </div>
    </div>
    
    <script>
        // Game data and logic remains the same as previous version
        let currentCase = {};
        let eliminatedSuspects = [];
        let shownClues = [];
        let currentCaseIndex = 0;
        let completedCases = [];
        const cases = [
            {
                title: "🏠 Vụ Trộm Tại Biệt Thự Sang Trọng",
                location: "Biệt thự của ông Minh, quận 1",
                time: "Tối 15/8/2025, 20:00",
                item: "Chiếc nhẫn kim cương trị giá 2 tỷ đồng",
                situation: "Ông Minh tổ chức tiệc sinh nhật, có 6 khách mời. Sau khi tiệc kết thúc, chiếc nhẫn kim cương trong két sắt biến mất!",
                suspects: [
                    {name: "Lan", avatar: "👩‍💼", description: "Thư ký của ông Minh", guilty: false},
                    {name: "Nam", avatar: "👨‍🍳", description: "Đầu bếp tiệc", guilty: false},
                    {name: "Hoa", avatar: "👩‍🎨", description: "Họa sĩ, bạn cũ", guilty: true},
                    {name: "Dũng", avatar: "👨‍💻", description: "Chuyên gia IT", guilty: false},
                    {name: "Mai", avatar: "👩‍⚕️", description: "Bác sĩ gia đình", guilty: false},
                    {name: "Tuấn", avatar: "👨‍🎵", description: "Nhạc sĩ kiêm DJ", guilty: false}
                ],
                clues: [
                    "🔐 Két sắt không có dấu hiệu bị phá, thủ phạm biết mật khẩu",
                    "👀 Camera an ninh thấy ai đó vào phòng làm việc lúc 21:30",
                    "💍 Thủ phạm đeo găng tay màu đỏ trong tiệc",
                    "📱 Điện thoại của thủ phạm rung liên tục, có vẻ đang nợ nần",
                    "🎨 Thủ phạm có kiến thức về kim cương và đá quý",
                    "☕ Thủ phạm không uống rượu, chỉ uống cà phê đen",
                    "🗝️ Chỉ có 3 người biết mật khẩu két: Lan, Hoa và ông Minh",
                    "🎭 Lan ở bếp suốt từ 21:00-22:00, có nhân chứng",
                    "🔍 Tìm thấy sợi vải màu đỏ gần két sắt"
                ]
            },
            {
                title: "🏢 Vụ Án Tại Văn Phòng",
                location: "Tầng 20 tòa nhà Landmark",
                time: "Sáng 16/8/2025, 08:30",
                item: "Hồ sơ bí mật của dự án trị giá 50 tỷ",
                situation: "Công ty ABC phát hiện hồ sơ dự án quan trọng bị đánh cắp. Có 5 nhân viên có quyền truy cập vào két tài liệu.",
                suspects: [
                    {name: "An", avatar: "👨‍💼", description: "Giám đốc nhân sự", guilty: false},
                    {name: "Bình", avatar: "👩‍💻", description: "Trưởng phòng IT", guilty: true},
                    {name: "Chi", avatar: "👩‍💼", description: "Kế toán trưởng", guilty: false},
                    {name: "Đạt", avatar: "👨‍🔧", description: "Bảo vệ ca đêm", guilty: false},
                    {name: "Eva", avatar: "👩‍🎓", description: "Thực tập sinh", guilty: false}
                ],
                clues: [
                    "💻 Hệ thống ghi nhận đăng nhập lúc 6:00 sáng",
                    "🔑 Thủ phạm có thẻ từ cấp cao",
                    "📊 Thủ phạm hiểu rõ giá trị của hồ sơ",
                    "☕ Tìm thấy cốc cà phê sữa gần két tài liệu",
                    "👔 Camera thấy người mặc áo xanh navy",
                    "📱 Thủ phạm dùng USB để copy dữ liệu",
                    "🚗 An đi công tác từ ngày 15/8, vắng mặt",
                    "🏃‍♀️ Chi bị bệnh, nghỉ làm 2 ngày",
                    "🔍 Bình từng làm việc cho công ty đối thủ"
                ]
            },
            {
                title: "💀 Vụ Án Mạng Tại Khách Sạn",
                location: "Phòng 507, Khách sạn Golden Star",
                time: "Đêm 17/8/2025, 23:45",
                item: "Tính mạng của doanh nhân Phạm Văn Thành",
                situation: "Doanh nhân Phạm Văn Thành được tìm thấy đã qua đời trong phòng khách sạn. Cảnh sát xác định đây là vụ án mạng có chủ đích. Có 6 người có động cơ và cơ hội gây án.",
                suspects: [
                    {name: "Linh", avatar: "👩‍💼", description: "Vợ cũ của nạn nhân", guilty: false},
                    {name: "Khang", avatar: "👨‍💻", description: "Đối tác kinh doanh", guilty: true},
                    {name: "Thủy", avatar: "👩‍⚕️", description: "Bác sĩ riêng", guilty: false},
                    {name: "Hoàng", avatar: "👨‍💼", description: "Luật sư của nạn nhân", guilty: false},
                    {name: "My", avatar: "👩‍🎭", description: "Người tình bí mật", guilty: false},
                    {name: "Sơn", avatar: "👨‍🔧", description: "Thợ sửa chữa khách sạn", guilty: false}
                ],
                clues: [
                    "⚰️ Nạn nhân chết do ngộ độc, không phải bạo lực",
                    "🍷 Tìm thấy ly rượu vang còn nguyên vẹn trên bàn",
                    "💊 Pháp y phát hiện chất độc trong máu nạn nhân",
                    "🏨 Thẻ từ cho thấy có người vào phòng lúc 23:30",
                    "📞 Cuộc gọi cuối cùng của nạn nhân là 23:15",
                    "💰 Nạn nhân vừa ký hợp đồng lớn trị giá 100 tỷ",
                    "🗝️ Linh không có thẻ từ, đã ly hôn 2 năm",
                    "💉 Thủy có kiến thức về thuốc và chất độc",
                    "📋 Khang là người thụ hưởng bảo hiểm 50 tỷ nếu nạn nhân chết",
                    "🔐 Chỉ có Khang và Hoàng có thẻ từ cấp cao"
                ]
            },
            {
                title: "👶 Vụ Bắt Cóc Trẻ Em",
                location: "Công viên Tao Đàn, quận 1",
                time: "Chiều 18/8/2025, 16:30",
                item: "Bé Minh An, 5 tuổi",
                situation: "Bé Minh An biến mất khi đang chơi ở công viên cùng gia đình. Camera an ninh ghi được cảnh một người lạ tiếp cận bé. Cảnh sát xác định có 5 nghi phạm tiềm năng.",
                suspects: [
                    {name: "Duy", avatar: "👨‍🏫", description: "Giáo viên mầm non", guilty: false},
                    {name: "Nga", avatar: "👩‍🍳", description: "Người bán kẹo gần công viên", guilty: false},
                    {name: "Tâm", avatar: "👨‍🎨", description: "Họa sĩ vẽ tranh", guilty: false},
                    {name: "Huyền", avatar: "👩‍🦳", description: "Người giúp việc cũ", guilty: true},
                    {name: "Quân", avatar: "👨‍🚗", description: "Tài xế taxi", guilty: false}
                ],
                clues: [
                    "👁️ Camera thấy người phụ nữ tóc dài tiếp cận bé",
                    "🍭 Bé được cho kẹo trước khi biến mất",
                    "🚗 Có xe màu trắng đậu gần công viên lúc 16:25",
                    "📱 Nghi phạm biết tên và thông tin cá nhân của bé",
                    "💰 Gia đình nhận được yêu cầu tiền chuộc 500 triệu",
                    "🏠 Nghi phạm biết rõ thói quen của gia đình",
                    "👔 Duy đang dạy học, có alibi rõ ràng",
                    "🎨 Tâm là nam giới, không khớp với mô tả camera",
                    "🚕 Quân có bằng lái xe, nhưng không có xe riêng",
                    "🔍 Huyền bị sa thải 1 tháng trước vì mâu thuẫn"
                ]
            },
            {
                title: "🔥 Vụ Phóng Hỏa Nhà Kho",
                location: "Khu công nghiệp Tân Bình",
                time: "Rạng sáng 19/8/2025, 02:00",
                item: "Nhà kho chứa hàng trị giá 20 tỷ đồng",
                situation: "Nhà kho của công ty vận tải bị cháy trong đêm. Điều tra ban đầu cho thấy đây là vụ phóng hỏa có chủ đích. Có 6 người có động cơ và khả năng thực hiện.",
                suspects: [
                    {name: "Đức", avatar: "👨‍💼", description: "Chủ nhà kho", guilty: false},
                    {name: "Loan", avatar: "👩‍🔧", description: "Công nhân bảo vệ", guilty: false},
                    {name: "Phong", avatar: "👨‍💻", description: "Kế toán công ty", guilty: true},
                    {name: "Hằng", avatar: "👩‍💼", description: "Đối tác cạnh tranh", guilty: false},
                    {name: "Việt", avatar: "👨‍🚒", description: "Cựu nhân viên", guilty: false},
                    {name: "Thoa", avatar: "👩‍⚖️", description: "Nhân viên bảo hiểm", guilty: false}
                ],
                clues: [
                    "🔥 Đám cháy bắt đầu từ góc nhà kho, gần tủ hồ sơ",
                    "⛽ Tìm thấy dấu vết xăng tại hiện trường",
                    "🕐 Hệ thống báo cháy bị tắt từ 01:45",
                    "🔑 Cửa nhà kho không có dấu hiệu bị phá khóa",
                    "📋 Hồ sơ tài chính quan trọng bị thiêu rụi",
                    "💰 Công ty đang có vấn đề về tài chính nghiêm trọng",
                    "👮 Loan không có mặt đêm đó, xin nghỉ phép đột xuất",
                    "🏢 Hằng đang kiện công ty về hợp đồng",
                    "💸 Phong có quyền truy cập vào tất cả hồ sơ tài chính",
                    "🔍 Phong từng làm việc muộn để 'sửa sổ sách'"
                ]
            },
            {
                title: "💎 Vụ Cướp Ngân Hàng",
                location: "Ngân hàng ACB, chi nhánh Nguyễn Huệ",
                time: "Sáng 20/8/2025, 09:30",
                item: "5 tỷ đồng tiền mặt",
                situation: "Một nhóm cướp đã thực hiện vụ cướp ngân hàng tinh vi. Tuy nhiên, cảnh sát nghi ngờ có nội gián hỗ trợ. Có 5 nhân viên ngân hàng đáng nghi.",
                suspects: [
                    {name: "Trang", avatar: "👩‍💼", description: "Quản lý chi nhánh", guilty: false},
                    {name: "Hùng", avatar: "👨‍💻", description: "Nhân viên bảo vệ", guilty: false},
                    {name: "Liên", avatar: "👩‍💻", description: "Giao dịch viên", guilty: true},
                    {name: "Nam", avatar: "👨‍🔧", description: "Kỹ thuật viên IT", guilty: false},
                    {name: "Vy", avatar: "👩‍💼", description: "Nhân viên tín dụng", guilty: false}
                ],
                clues: [
                    "⏰ Vụ cướp xảy ra đúng lúc đổi ca bảo vệ",
                    "🚨 Hệ thống báo động bị tắt từ bên trong",
                    "🔐 Két sắt được mở bằng mã số, không bị phá",
                    "📷 Camera an ninh bị che khuất một cách khéo léo",
                    "📱 Có cuộc gọi bí ẩn đến số nội bộ trước vụ cướp",
                    "💰 Nhóm cướp biết chính xác vị trí tiền mặt",
                    "🏃‍♂️ Trang đang họp với giám đốc tại tầng 3",
                    "💻 Nam đang sửa máy tính tại chi nhánh khác",
                    "📞 Liên nhận được nhiều cuộc gọi lạ trong tuần",
                    "💸 Liên có khoản nợ lớn tại sòng bạc"
                ]
            }
        ];
        
        function initGame() {
            if (completedCases.length === 0) {
                currentCaseIndex = 0;
            }
           
            currentCase = cases[currentCaseIndex];
            eliminatedSuspects = [];
            shownClues = [];
            displayCase();
            displaySuspects();
            showNewClue();
            updateProgress();
        }
        
        function displayCase() {
            const caseDetails = document.getElementById('caseDetails');
            caseDetails.innerHTML = `
                <h3>${currentCase.title}</h3>
                <p><strong>Thời gian:</strong> ${currentCase.time}</p>
                <p><strong>Địa điểm:</strong> ${currentCase.location}</p>
                <p><strong>Vật bị mất:</strong> ${currentCase.item}</p>
                <p><strong>Tình huống:</strong> ${currentCase.situation}</p>
            `;
        }
        
        function displaySuspects() {
            const suspectsGrid = document.getElementById('suspectsGrid');
            suspectsGrid.innerHTML = '';
           
            currentCase.suspects.forEach((suspect, index) => {
                const suspectCard = document.createElement('div');
                suspectCard.className = 'suspect-card';
                suspectCard.id = `suspect-${index}`;
                suspectCard.onclick = () => toggleSuspect(index);
               
                if (eliminatedSuspects.includes(index)) {
                    suspectCard.classList.add('eliminated');
                }
               
                suspectCard.innerHTML = `
                    <div class="suspect-avatar">${suspect.avatar}</div>
                    <h4>${suspect.name}</h4>
                    <p>${suspect.description}</p>
                `;
               
                suspectsGrid.appendChild(suspectCard);
            });
            updateEliminatedList();
        }
        
        function toggleSuspect(index) {
            const suspectCard = document.getElementById(`suspect-${index}`);
            const isEliminated = eliminatedSuspects.includes(index);
           
            if (isEliminated) {
                eliminatedSuspects = eliminatedSuspects.filter(i => i !== index);
                suspectCard.classList.remove('eliminated');
            } else {
                eliminatedSuspects.push(index);
                suspectCard.classList.add('eliminated');
            }
           
            updateEliminatedList();
        }
        
        function updateEliminatedList() {
            const eliminatedList = document.getElementById('eliminatedList');
            const eliminatedNames = document.getElementById('eliminatedNames');
           
            if (eliminatedSuspects.length > 0) {
                eliminatedList.style.display = 'block';
                const names = eliminatedSuspects.map(i => currentCase.suspects[i].name).join(', ');
                eliminatedNames.textContent = names;
            } else {
                eliminatedList.style.display = 'none';
            }
        }
        
        function showNewClue() {
            if (shownClues.length >= currentCase.clues.length) {
                alert('🔍 Đã hết manh mối! Hãy đưa ra kết luận!');
                return;
            }
            const availableClues = currentCase.clues.filter((_, index) => !shownClues.includes(index));
            const randomIndex = Math.floor(Math.random() * availableClues.length);
            const clueIndex = currentCase.clues.indexOf(availableClues[randomIndex]);
            shownClues.push(clueIndex);
            displayClues();
        }
        
        function displayClues() {
            const cluesList = document.getElementById('cluesList');
            cluesList.innerHTML = '';
           
            shownClues.forEach(clueIndex => {
                const clueItem = document.createElement('div');
                clueItem.className = 'clue-item';
                clueItem.textContent = currentCase.clues[clueIndex];
                cluesList.appendChild(clueItem);
            });
        }
        
        function makeGuess() {
            const remainingSuspects = currentCase.suspects.filter((_, index) => !eliminatedSuspects.includes(index));
           
            if (remainingSuspects.length === 0) {
                showResult(false, "Bạn đã loại trừ tất cả nghi phạm! 🤔");
                return;
            }
           
            if (remainingSuspects.length === 1) {
                const lastSuspect = remainingSuspects[0];
                if (lastSuspect.guilty) {
                    showResult(true, `Chính xác! ${lastSuspect.name} (${lastSuspect.avatar}) là thủ phạm!`);
                } else {
                    showResult(false, `Sai rồi! ${lastSuspect.name} không phải thủ phạm.`);
                }
                return;
            }
           
            selectCulprit();
        }
        
        function selectCulprit() {
            const remainingSuspects = currentCase.suspects.filter((_, index) => !eliminatedSuspects.includes(index));
           
            currentCase.suspects.forEach((suspect, index) => {
                const card = document.getElementById(`suspect-${index}`);
                if (!eliminatedSuspects.includes(index)) {
                    card.classList.add('selected');
                    card.onclick = () => checkGuess(index);
                }
            });
           
            alert('Hãy nhấp vào nghi phạm mà bạn cho là thủ phạm!');
        }
        
        function checkGuess(suspectIndex) {
            const suspect = currentCase.suspects[suspectIndex];
           
            if (suspect.guilty) {
                showResult(true, `🎉 Xuất sắc! ${suspect.name} (${suspect.avatar}) chính là thủ phạm!`);
            } else {
                const realCulprit = currentCase.suspects.find(s => s.guilty);
                showResult(false, `❌ Sai rồi! Thủ phạm thật sự là ${realCulprit.name} (${realCulprit.avatar})`);
            }
           
            currentCase.suspects.forEach((_, index) => {
                const card = document.getElementById(`suspect-${index}`);
                card.classList.remove('selected');
                card.onclick = () => toggleSuspect(index);
            });
        }
        
        function showResult(success, message) {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const content = document.getElementById('resultContent');
           
            title.textContent = success ? '🎉 CHÚC MỪNG!' : '😔 THẤT BẠI!';
           
            let progressInfo = '';
            let buttons = '';
           
            if (success) {
                if (!completedCases.includes(currentCaseIndex)) {
                    completedCases.push(currentCaseIndex);
                }
               
                if (completedCases.length < cases.length) {
                    progressInfo = `<div class="progress-info">Tiến độ: ${completedCases.length}/${cases.length} vụ án đã giải quyết</div>`;
                    buttons = `<button class="btn success" onclick="nextCase(); closeModal();">🔍 Vụ Án Tiếp Theo</button>
                              <button class="btn" onclick="closeModal()">Đóng</button>`;
                } else {
                    progressInfo = '<div class="progress-info" style="background: rgba(253, 203, 110, 0.2); border-color: rgba(253, 203, 110, 0.3);">🏆 CHÚC MỪNG! BẠN ĐÃ GIẢI QUYẾT TẤT CẢ CÁC VỤ ÁN! 🏆</div>';
                    buttons = `<button class="btn success" onclick="resetAllCases(); closeModal();">🔄 Bắt Đầu Lại</button>
                              <button class="btn" onclick="closeModal()">Đóng</button>`;
                }
            } else {
                buttons = `<button class="btn warning" onclick="closeModal()">🔄 Chơi Lại</button>
                          <button class="btn" onclick="closeModal()">Đóng</button>`;
            }
           
            content.innerHTML = `
                <p style="font-size: 1.1rem; margin-bottom: 15px;">${message}</p>
                ${progressInfo}
                <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px; font-size: 1rem;">📝 Giải thích:</h4>
                    <div style="margin-top: 10px;">
                        ${currentCase.clues.slice(0, Math.min(shownClues.length + 2, currentCase.clues.length)).map(clue =>
                            `<p style="margin: 6px 0; padding-left: 8px; border-left: 2px solid var(--primary); font-size: 0.9rem;">${clue}</p>`
                        ).join('')}
                    </div>
                </div>
                <div class="modal-buttons">
                    ${buttons}
                </div>
            `;
           
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }
        
        function showHelpModal() {
            document.getElementById('helpModal').style.display = 'flex';
        }
        
        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }
        
        function goBack() {
            window.location.href = "game.html";
        }
        
        function newCase() {
            initGame();
        }
        
        function nextCase() {
            let nextIndex = -1;
            for (let i = 0; i < cases.length; i++) {
                if (!completedCases.includes(i)) {
                    nextIndex = i;
                    break;
                }
            }
           
            if (nextIndex !== -1) {
                currentCaseIndex = nextIndex;
                initGame();
            } else {
                resetAllCases();
            }
        }
        
        function resetAllCases() {
            completedCases = [];
            currentCaseIndex = 0;
            initGame();
        }
        
        function updateProgress() {
            const header = document.querySelector('.header p');
            if (completedCases.length > 0) {
                header.textContent = `Sử dụng các manh mối để tìm ra thủ phạm! (Đã giải: ${completedCases.length}/${cases.length} vụ án)`;
            } else {
                header.textContent = "Sử dụng các manh mối để tìm ra thủ phạm!";
            }
        }
        
        window.onload = initGame;
    </script>
</body>
</html>
